digraph protocol {

	node [shape=ellipse];
	connect;
	disconnect;
	main [label="wait for command"];

	{ rank=same;
		known_client [label="Known\nClient"];
		unknown_client [label="Unknown\nClient"];
	};
	{ rank=same;
		known_command [label="Known\nCommand"];
		unknown_command [label="Unknown\nCommand"];
	};

	node [shape=rect];
	HELLO;

	{ rank=same;
		IDENTIFY;

		BYE;
		QUERY;
		RETRIEVE;
		REPORT;
	};

	connect -> HELLO;
	HELLO -> known_client -> main;
	HELLO -> unknown_client -> IDENTIFY -> disconnect;

	main -> unknown_command -> disconnect;
	main -> known_command;

	known_command -> BYE -> disconnect;
	known_command -> QUERY -> main;
	known_command -> RETRIEVE -> main;
	known_command -> REPORT -> main;
}
